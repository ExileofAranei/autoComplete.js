var a,b;a=this,b=function(){"use strict";function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(t,e){var i,n=Object.keys(t);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(t),e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)),n}function c(n){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?t(Object(r),!0).forEach(function(e){var t,i;t=n,e=r[i=e],i in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(r,e))})}return n}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function l(e,t){var i;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return a(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(i="Object"===i&&e.constructor?e.constructor.name:i)||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,o=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return s=e.done,e},e:function(e){o=!0,r=e},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw r}}}}function d(e,t){for(var i=document.getElementsByClassName(e.resultsList.className),n=0;n<i.length;n++)t!==i[n]&&t!==e.inputField&&(i[n].parentNode.removeChild(i[n]),e.resultsList.node=null);e.inputField.removeAttribute("aria-activedescendant"),e.inputField.setAttribute("aria-expanded",!1)}function r(o,a,l){var e,t,u=(e=o,(t=document.createElement(e.resultsList.element)).setAttribute("id",e.resultsList.idName),t.setAttribute("aria-label",e.name),t.setAttribute("class",e.resultsList.className),t.setAttribute("role","listbox"),t.setAttribute("tabindex","-1"),e.resultsList.container&&e.resultsList.container(t),("string"==typeof e.resultsList.destination?document.querySelector(e.resultsList.destination):e.resultsList.destination()).insertAdjacentElement(e.resultsList.position,t),t);o.resultsList.node=u,o.inputField.setAttribute("aria-expanded",!0);for(var i=function(t){var e,i,n,r,s=a.results[t],r=(e=s,i=t,n=o,(r=document.createElement(n.resultItem.element)).setAttribute("id","".concat(n.resultItem.idName,"_").concat(i)),r.setAttribute("class",n.resultItem.className),r.setAttribute("role","option"),r.innerHTML=e.match,n.resultItem.content&&n.resultItem.content(e,r),r);r.addEventListener("click",function(e){e={event:e,matches:l,input:a.input,query:a.query,results:a.results,selection:c(c({},s),{},{index:t})};o.onSelection&&o.onSelection(e),o.closeOnSelection&&d(o)}),u.appendChild(r)},n=0;n<a.results.length;n++)i(n);return u}function u(e,t,i){e.dispatchEvent(new CustomEvent(i,{bubbles:!0,detail:t,cancelable:!0}))}function s(i,o){function n(e,t,i,n){e.preventDefault(),i?a++:a--,l(t),n.inputField.setAttribute("aria-activedescendant",t[a].id);var t=(n=t[a]).parentNode,r=window.getComputedStyle(n),s=n.offsetHeight;["marginTop","marginBottom"].forEach(function(e){return s+=parseFloat(r[e])}),t.scrollTop=n.offsetTop+s-t.offsetHeight,u(e.srcElement,c(c({event:e},o),{},{selection:o.results[a]}),"navigation")}var a=-1,l=function(e){if(!e)return!1;!function(e){for(var t=0;t<e.length;t++)e[t].removeAttribute("aria-selected"),""!==i.selection.className&&e[t].classList.remove(i.selection.className)}(e),e[a=(a=a>=e.length?0:a)<0?e.length-1:a].setAttribute("aria-selected","true"),""!==i.selection.className&&e[a].classList.add(i.selection.className)},r=i.resultsList.navigation||function(e){var t=document.getElementById(i.resultsList.idName);if(!t)return i.inputField.removeEventListener("keydown",r);t=t.getElementsByTagName(i.resultItem.element),27===e.keyCode?(i.inputField.value="",d(i)):40===e.keyCode||!e.shiftKey&&9===e.keyCode?n(e,t,!0,i):38===e.keyCode||e.shiftKey&&9===e.keyCode?n(e,t,!1,i):13===e.keyCode&&(e.preventDefault(),-1<a&&t&&t[a].click())};i.inputField.autoCompleteNavigate&&i.inputField.removeEventListener("keydown",i.inputField.autoCompleteNavigate),i.inputField.autoCompleteNavigate=r,i.inputField.addEventListener("keydown",r)}function o(s,o){for(var a=[],e=function(i){function e(e){var t=(e?n[e]:n).toString();t&&((t="function"==typeof s.searchEngine?s.searchEngine(o,t):function(e,t,i){var n=i.diacritics?t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").normalize("NFC"):t.toLowerCase();if("loose"===i.searchEngine){e=e.replace(/ /g,"");for(var r=[],s=0,o=0;o<n.length;o++){var a=t[o];s<e.length&&n[o]===e[s]&&(a=i.highlight.render?'<span class="'.concat(i.highlight.className,'">').concat(a,"</span>"):a,s++),r.push(a)}if(s===e.length)return r.join("")}else if(n.includes(e))return e=new RegExp("".concat(e),"i").exec(t),i.highlight.render?t.replace(e,'<span class="'.concat(i.highlight.className,'">').concat(e,"</span>")):t}(o,t,s))&&e?a.push({key:e,index:i,match:t,value:n}):t&&!e&&a.push({index:i,match:t,value:n}))}var n=s.data.store[i];if(s.data.key){var t,r=l(s.data.key);try{for(r.s();!(t=r.n()).done;)e(t.value)}catch(e){r.e(e)}finally{r.f()}}else e()},t=0;t<s.data.store.length;t++)e(t);return s.sort?a.sort(s.sort):a}var i,n,h;function D(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,D);var t=e.name,i=void 0===t?"Search":t,n=e.selector,r=void 0===n?"#autoComplete":n,s=e.observer,o=void 0!==s&&s,a=e.data,l=a.src,u=a.key,c=a.cache,d=void 0!==c&&c,h=a.store,p=a.results,m=e.query,f=e.trigger,v=(f=void 0===f?{}:f).event,g=void 0===v?["input"]:v,b=f.condition,y=void 0!==b&&b,k=e.searchEngine,C=void 0===k?"strict":k,L=e.diacritics,F=void 0!==L&&L,N=e.threshold,E=void 0===N?1:N,O=e.debounce,A=void 0===O?0:O,w=e.resultsList,S=(w=void 0===w?{}:w).render,j=void 0===S||S,x=w.container,I=void 0!==x&&x,H=w.destination,T=w.position,P=void 0===T?"afterend":T,q=w.element,R=void 0===q?"ul":q,t=w.idName,n=void 0===t?"autoComplete_list":t,s=w.className,c=void 0===s?"autoComplete_list":s,a=w.navigation,v=void 0!==a&&a,f=e.sort,b=void 0!==f&&f,k=e.placeHolder,L=e.maxResults,N=void 0===L?5:L,O=e.resultItem,S=(O=void 0===O?{}:O).content,x=void 0!==S&&S,T=O.element,q=void 0===T?"li":T,t=O.idName,s=void 0===t?"autoComplete_result":t,w=O.className,a=void 0===w?"autoComplete_result":w,f=e.noResults,L=e.selection,S=(L=void 0===L?{}:L).className,T=void 0===S?"autoComplete_selected":S,t=e.highlight,O=(t=void 0===t?{}:t).render,w=void 0!==O&&O,L=t.className,S=void 0===L?"autoComplete_highlighted":L,O=e.feedback,t=e.onSelection,L=e.onOutsideClick,e=e.closeOnSelection,e=void 0!==e&&e;this.name=i,this.selector=r,this.observer=o,this.data={src:l,key:u,cache:d,store:h,results:p},this.query=m,this.trigger={event:g,condition:y},this.searchEngine=C,this.diacritics=F,this.threshold=E,this.debounce=A,this.resultsList={render:j,container:I,destination:H||this.selector,position:P,element:R,idName:n,className:c,navigation:v},this.sort=b,this.placeHolder=k,this.maxResults=N,this.resultItem={content:x,element:q,idName:s,className:a},this.noResults=f,this.selection={className:T},this.highlight={render:w,className:S},this.feedback=O,this.onSelection=t,this.onOutsideClick=L,this.closeOnSelection=e,this.inputField="string"==typeof this.selector?document.querySelector(this.selector):this.selector(),this.observer?this.preInit():this.init()}return i=D,(n=[{key:"start",value:function(e,t){var n=this,i=this.data.results?this.data.results(o(this,t)):o(this,t),t={input:e,query:t,matches:i,results:this.maxResults?i.slice(0,this.maxResults):i};return u(this.inputField,t,"autoComplete.open"),i.length?this.resultsList.render?(i.length&&r(this,t,i),u(this.inputField,t,"rendered"),s(this,t),void(this.isOutsideEventAttached||(this.isOutsideEventAttached=!0,this.outsideClickHandler=function(e){var t=n.resultsList.node,i=e.target;t===i||t.contains(i)||(d(n,e.target),u(n.inputField,null,"autoComplete.close"),n.onOutsideClick&&n.onOutsideClick(n),n.isOutsideEventAttached=!1,n.removeOutsideClickHandler())},this.removeOutsideClickHandler=function(){return document.removeEventListener("click",n.outsideClickHandler)},document.addEventListener("click",this.outsideClickHandler)))):this.feedback(t):this.noResults?this.noResults(t,r):null}},{key:"dataStore",value:function(){var n=this;return new Promise(function(t,i){return n.data.cache&&n.data.store?t(null):new Promise(function(e,t){return"function"==typeof n.data.src?n.data.src(n).then(e,t):e(n.data.src)}).then(function(e){try{return n.data.store=e,u(n.inputField,n.data.store,"fetch"),t()}catch(e){return i(e)}},i)})}},{key:"compose",value:function(){var a=this;return new Promise(function(e,t){var i,n,r,s;return s=a.inputField,i=(s instanceof HTMLInputElement||s instanceof HTMLTextAreaElement?s.value:s.innerHTML).toLowerCase(),r=i,n=(s=a).query&&s.query.manipulate?s.query.manipulate(r):s.diacritics?r.normalize("NFD").replace(/[\u0300-\u036f]/g,"").normalize("NFC"):r,s=n,((r=a).trigger.condition?r.trigger.condition(s):s.length>=r.threshold&&s.replace(/ /g,"").length)?a.dataStore().then(function(e){try{return d(a),a.start(i,n),o.call(a)}catch(e){return t(e)}},t):(d(a),o.call(a));function o(){return e()}})}},{key:"init",value:function(){var e,i,n,r,t=this;(e=this).inputField.setAttribute("role","combobox"),e.inputField.setAttribute("aria-haspopup",!0),e.inputField.setAttribute("aria-expanded",!1),e.inputField.setAttribute("aria-controls",e.resultsList.idName),e.inputField.setAttribute("aria-autocomplete","both"),this.placeHolder&&this.inputField.setAttribute("placeholder",this.placeHolder),this.hook=(i=function(){t.compose()},n=this.debounce,function(){var e=this,t=arguments;clearTimeout(r),r=setTimeout(function(){return i.apply(e,t)},n)}),this.trigger.event.forEach(function(e){t.inputField.removeEventListener(e,t.hook),t.inputField.addEventListener(e,t.hook)}),u(this.inputField,null,"init")}},{key:"preInit",value:function(){var r=this;new MutationObserver(function(e,t){var i,n=l(e);try{for(n.s();!(i=n.n()).done;){i.value;r.inputField&&(t.disconnect(),u(r.inputField,null,"connect"),r.init())}}catch(e){n.e(e)}finally{n.f()}}).observe(document,{childList:!0,subtree:!0})}},{key:"unInit",value:function(){this.inputField.removeEventListener("input",this.hook),u(this.inputField,null,"unInit")}}])&&e(i.prototype,n),h&&e(i,h),D},"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):(a="undefined"!=typeof globalThis?globalThis:a||self).autoComplete=b();
